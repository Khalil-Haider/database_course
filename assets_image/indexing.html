<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Database Index Visualization</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.441.0/dist/umd/lucide.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/esbuild-wasm@0.23.0/esbuild.wasm.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>
  <script>
    // Initialize esbuild
    esbuild.initialize({
      wasmURL: 'https://cdn.jsdelivr.net/npm/esbuild-wasm@0.23.0/esbuild.wasm'
    }).then(() => {
      // Transpile JSX to JavaScript
      const code = `
        const { useState } = React;
        lucide.createIcons();
        const { Search, ArrowRight } = lucide;

        function DatabaseIndexVisualization() {
          const [activeTab, setActiveTab] = useState('noIndex');
          const [searchActive, setSearchActive] = useState(false);
          const [searchStep, setSearchStep] = useState(0);
          const [indexSearchActive, setIndexSearchActive] = useState(false);
          const [indexSearchStep, setIndexSearchStep] = useState(0);
          const [indexTreeActive, setIndexTreeActive] = useState(false);
          const [indexTreeStep, setIndexTreeStep] = useState(0);
          const [currentPage, setCurrentPage] = useState('main');

          const tableData = [
            { id: 1, name: "Alice", email: "alice@example.com", department: "Marketing" },
            { id: 2, name: "Charlie", email: "charlie@example.com", department: "Engineering" },
            { id: 3, name: "David", email: "david@example.com", department: "HR" },
            { id: 4, name: "Emma", email: "emma@example.com", department: "Finance" },
            { id: 5, name: "Bob", email: "bob@example.com", department: "Sales" },
          ];

          const bTree = {
            root: {
              keys: ['c'],
              children: [
                {
                  keys: ['alice@example.com', 'bob@example.com'],
                  pointers: [1, 5]
                },
                {
                  keys: ['charlie@example.com', 'david@example.com', 'emma@example.com'],
                  pointers: [2, 3, 4]
                }
              ]
            }
          };

          const startSearch = () => {
            setSearchActive(true);
            setSearchStep(0);
            const timer = setInterval(() => {
              setSearchStep(prevStep => {
                if (prevStep < tableData.length - 1) {
                  return prevStep + 1;
                } else {
                  clearInterval(timer);
                  setTimeout(() => {
                    setSearchActive(false);
                    setSearchStep(0);
                  }, 1000);
                  return prevStep;
                }
              });
            }, 500);
          };

          const startIndexSearch = () => {
            setIndexSearchActive(true);
            setIndexTreeActive(true);
            setIndexTreeStep(0);
            setIndexSearchStep(0);

            const treeTimer = setInterval(() => {
              setIndexTreeStep(prevStep => {
                if (prevStep < 2) {
                  return prevStep + 1;
                } else {
                  clearInterval(treeTimer);
                  setTimeout(() => {
                    setIndexSearchStep(4); // Bob's row (index 4)
                    setTimeout(() => {
                      setIndexSearchActive(false);
                      setIndexTreeActive(false);
                      setIndexTreeStep(0);
                      setIndexSearchStep(0);
                    }, 1000);
                  }, 500);
                  return prevStep;
                }
              });
            }, 700);
          };

          if (currentPage === 'next') {
            return (
              <div className="flex flex-col w-full max-w-5xl mx-auto p-4 bg-gray-50 rounded-lg">
                <h1 className="text-3xl font-bold text-center">Next Page</h1>
                <p className="text-gray-600 text-center mt-4">This is a placeholder for the next page.</p>
                <button
                  className="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 w-full max-w-xs mx-auto"
                  onClick={() => setCurrentPage('main')}
                >
                  Back to Main Page
                </button>
              </div>
            );
          }

          return (
            <div className="flex flex-col w-full max-w-5xl mx-auto p-4 bg-gray-50 rounded-lg">
              <div className="mb-8 text-center">
                <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-500 to-purple-600 text-transparent bg-clip-text">
                  Table Indexing in SQL
                </h1>
                <div className="h-1 w-full max-w-lg mx-auto mt-2 bg-gradient-to-r from-blue-500 to-purple-600 rounded"></div>
                <p className="text-gray-600 mt-2">How indexes improve query performance</p>
              </div>

              <div className="flex mb-6 border-b">
                <button 
                  className={\`px-6 py-3 \${activeTab === 'noIndex' ? 'border-b-2 border-red-500 text-red-600 font-semibold' : 'text-gray-600'}\`}
                  onClick={() => setActiveTab('noIndex')}
                >
                  Table Without Index
                </button>
                <button 
                  className={\`px-6 py-3 \${activeTab === 'withIndex' ? 'border-b-2 border-green-500 text-green-600 font-semibold' : 'text-gray-600'}\`}
                  onClick={() => setActiveTab('withIndex')}
                >
                  Table With Index
                </button>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className={\`\${activeTab !== 'noIndex' && 'hidden md:block'}\`}>
                  <div className="flex flex-col bg-white border-2 border-gray-200 rounded-lg overflow-hidden shadow-md">
                    <div className="bg-gradient-to-r from-red-700 to-red-500 p-4 text-white">
                      <h2 className="text-xl font-bold text-center">Table Without Index</h2>
                    </div>
                    
                    <div className="p-4">
                      <div className="mb-4 border rounded">
                        <div className="bg-red-100 p-2 border-b flex">
                          <div className="w-1/6 font-bold text-red-800 border-r px-2">ID</div>
                          <div className="w-2/6 font-bold text-red-800 border-r px-2">Name</div>
                          <div className="w-3/6 font-bold text-red-800 px-2">Email</div>
                        </div>
                        
                        {tableData.map((row, index) => (
                          <div 
                            key={row.id} 
                            className={\`flex border-b \${searchActive && index === searchStep ? 'bg-yellow-100' : 'hover:bg-gray-50'}\`}
                          >
                            <div className="w-1/6 border-r px-2 py-1">{row.id}</div>
                            <div className="w-2/6 border-r px-2 py-1">{row.name}</div>
                            <div className="w-3/6 px-2 py-1 relative">
                              {row.email}
                              {searchActive && index === searchStep && (
                                <div className="absolute top-1/2 right-2 transform -translate-y-1/2">
                                  <div className="h-3 w-3 rounded-full bg-red-500 animate-pulse"></div>
                                </div>
                              )}
                            </div>
                          </div>
                        ))}
                        
                        <div className="border-t border-dashed flex">
                          <div className="w-full px-2 py-1 text-center text-gray-500">. . . 100+ more rows . . .</div>
                        </div>
                      </div>
                      
                      <div className="flex mb-4 items-center">
                        <div className="w-10 h-20 mr-2">
                          <svg viewBox="0 0 40 80" className="w-full h-full">
                            <path d="M 10,0 L 10,80" stroke="#d1d5db" strokeWidth="2" />
                            <path d="M 10,10 L 30,10 L 30,25 L 10,25 L 10,40 L 30,40 L 30,55 L 10,55 L 10,70" 
                                  stroke="#ef4444" strokeWidth="3" fill="none" strokeLinecap="round" strokeLinejoin="round" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center mb-1">
                            <div className="h-3 w-3 rounded-full bg-red-500 mr-2"></div>
                            <span className="font-semibold text-red-700">Sequential Scan</span>
                          </div>
                          <p className="text-sm text-gray-600">Must check every row one by one</p>
                        </div>
                      </div>
                      
                      <div className="bg-gray-900 text-gray-100 p-2 rounded text-sm font-mono overflow-x-auto">
                        SELECT * FROM users WHERE email = 'bob@example.com';
                      </div>
                      
                      <button 
                        className="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 w-full"
                        onClick={startSearch}
                        disabled={searchActive}
                      >
                        {searchActive ? "Searching..." : "Search for 'bob@example.com'"}
                      </button>
                    </div>
                  </div>
                </div>
                
                <div className={\`\${activeTab !== 'withIndex' && 'hidden md:block'}\`}>
                  <div className="flex flex-col bg-white border-2 border-gray-200 rounded-lg overflow-hidden shadow-md">
                    <div className="bg-gradient-to-r from-green-700 to-green-500 p-4 text-white">
                      <h2 className="text-xl font-bold text-center">Table With Index</h2>
                    </div>
                    
                    <div className="p-4">
                      <div className="mb-4 border rounded p-3 bg-green-50">
                        <h3 className="font-semibold text-green-800 mb-2">B-Tree Index on Email</h3>
                        
                        <div className="flex flex-col items-center">
                          <div className={\`px-4 py-2 border border-green-700 rounded mb-3 \${indexTreeActive && indexTreeStep >= 0 ? 'bg-green-200' : 'bg-green-100'}\`}>
                            <span className="font-medium text-green-800">B-tree Root (c)</span>
                          </div>
                          
                          <div className="flex justify-center w-full mb-3">
                            <div className={\`px-4 py-2 border border-green-700 rounded mx-2 \${indexTreeActive && indexTreeStep >= 1 && 'bob@example.com' <= 'c' ? 'bg-green-200' : 'bg-green-100'}\`}>
                              alice-bob
                            </div>
                            <div className={\`px-4 py-2 border border-green-700 rounded mx-2 \${indexTreeActive && indexTreeStep >= 1 && 'bob@example.com' > 'c' ? 'bg-green-200' : 'bg-green-100'}\`}>
                              charlie-emma
                            </div>
                          </div>
                          
                          <div className="flex justify-center flex-wrap w-full">
                            {bTree.root.children[0].keys.map((key, i) => (
                              <div 
                                key={key}
                                className={\`px-3 py-1 border border-green-700 rounded m-1 text-sm \${indexTreeActive && indexTreeStep >= 2 && key === 'bob@example.com' ? 'bg-green-200' : 'bg-green-100'}\`}
                              >
                                {key.split('@')[0]} → Row {bTree.root.children[0].pointers[i]}
                              </div>
                            ))}
                          </div>
                          
                          {indexTreeActive && indexTreeStep >= 2 && (
                            <div className="w-full mt-2 flex justify-center">
                              <ArrowRight className="text-green-600 animate-pulse" size={20} />
                            </div>
                          )}
                        </div>
                      </div>
                      
                      <div className="mb-4 border rounded">
                        <div className="bg-green-100 p-2 border-b flex">
                          <div className="w-1/6 font-bold text-green-800 border-r px-2">ID</div>
                          <div className="w-2/6 font-bold text-green-800 border-r px-2">Name</div>
                          <div className="w-3/6 font-bold text-green-800 px-2">Email (Indexed)</div>
                        </div>
                        
                        {tableData.map((row, index) => (
                          <div 
                            key={row.id} 
                            className={\`flex border-b \${indexSearchActive && index === indexSearchStep ? 'bg-green-100' : 'hover:bg-gray-50'}\`}
                          >
                            <div className="w-1/6 border-r px-2 py-1">{row.id}</div>
                            <div className="w-2/6 border-r px-2 py-1">{row.name}</div>
                            <div className="w-3/6 px-2 py-1 relative">
                              {row.email}
                              {indexSearchActive && index === indexSearchStep && (
                                <div className="absolute top-1/2 right-2 transform -translate-y-1/2">
                                  <div className="h-3 w-3 rounded-full bg-green-500 animate-pulse"></div>
                                </div>
                              )}
                            </div>
                          </div>
                        ))}
                        
                        <div className="border-t border-dashed flex">
                          <div className="w-full px-2 py-1 text-center text-gray-500">. . . 100+ more rows . . .</div>
                        </div>
                      </div>
                      
                      <div className="flex mb-4 items-center">
                        <div className="w-10 h-20 mr-2">
                          <svg viewBox="0 0 40 80" className="w-full h-full">
                            <path d="M 10,40 L 30,40" stroke="#22c55e" strokeWidth="3" strokeDasharray="5,3" />
                            <circle cx="30" cy="40" r="5" fill="#22c55e" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center mb-1">
                            <div className="h-3 w-3 rounded-full bg-green-500 mr-2"></div>
                            <span className="font-semibold text-green-700">Direct Index Lookup</span>
                          </div>
                          <p className="text-sm text-gray-600">Goes straight to the correct row</p>
                        </div>
                      </div>
                      
                      <div className="bg-gray-900 text-gray-100 p-2 rounded text-sm font-mono overflow-x-auto">
                        SELECT * FROM users WHERE email = 'bob@example.com';
                      </div>
                      
                      <button 
                        className="mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 w-full"
                        onClick={startIndexSearch}
                        disabled={indexSearchActive}
                      >
                        {indexSearchActive ? "Searching..." : "Search for 'bob@example.com'"}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div className="mt-6">
                <div className="flex flex-col bg-white border-2 border-gray-200 rounded-lg overflow-hidden shadow-md">
                  <div className="bg-gradient-to-r from-orange-700 to-orange-500 p-4 text-white">
                    <h2 className="text-xl font-bold text-center">Indexing Guidelines</h2>
                  </div>
                  
                  <div className="p-4">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <h3 className="font-semibold text-gray-800 mb-3">Database Automatically:</h3>
                        <ul className="space-y-2">
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-green-600 font-bold text-sm">✓</span>
                            </div>
                            <span>Creates indexes for PRIMARY KEY columns</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-green-600 font-bold text-sm">✓</span>
                            </div>
                            <span>Creates indexes for UNIQUE columns</span>
                          </li>
                        </ul>
                        
                        <h3 className="font-semibold text-gray-800 mt-6 mb-3">You Should Index:</h3>
                        <ul className="space-y-2">
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-green-600 font-bold text-sm">✓</span>
                            </div>
                            <span>Columns you frequently use in WHERE clauses</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-green-600 font-bold text-sm">✓</span>
                            </div>
                            <span>Columns used for joins to improve join performance</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-green-600 font-bold text-sm">✓</span>
                            </div>
                            <span>Columns frequently used in ORDER BY clauses</span>
                          </li>
                        </ul>
                        
                        <h3 className="font-semibold text-gray-800 mt-6 mb-3">Avoid Indexing:</h3>
                        <ul className="space-y-2">
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-red-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-red-600 font-bold text-sm">✗</span>
                            </div>
                            <span>Columns that contain too many NULL values</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-red-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-red-600 font-bold text-sm">✗</span>
                            </div>
                            <span>Small tables (overhead exceeds benefit)</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-red-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-red-600 font-bold text-sm">✗</span>
                            </div>
                            <span>Columns with low cardinality (few distinct values)</span>
                          </li>
                        </ul>
                      </div>
                      
                      <div>
                        <h3 className="font-semibold text-gray-800 mb-3">SQL Syntax:</h3>
                        <div className="bg-gray-900 text-gray-100 p-3 rounded text-sm font-mono mb-4">
                          CREATE INDEX index_name ON table_name (column);
                        </div>
                        
                        <h3 className="font-semibold text-gray-800 mb-3">Example:</h3>
                        <div className="bg-gray-900 text-gray-100 p-3 rounded text-sm font-mono mb-4">
                          CREATE INDEX idx_email ON users (email);
                        </div>
                        
                        <h3 className="font-semibold text-gray-800 mb-3">Advanced Features:</h3>
                        <ul className="space-y-2">
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-blue-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-blue-600 font-bold text-sm">i</span>
                            </div>
                            <span>Supports B-tree, hash, GiST, and GIN index methods</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-blue-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-blue-600 font-bold text-sm">i</span>
                            </div>
                            <span>Partial indexes for specific table subsets</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-blue-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-blue-600 font-bold text-sm">i</span>
                            </div>
                            <span>Multi-column indexes for complex queries</span>
                          </li>
                          <li className="flex items-start">
                            <div className="h-5 w-5 rounded-full bg-blue-100 flex items-center justify-center mt-0.5 mr-2">
                              <span className="text-blue-600 font-bold text-sm">i</span>
                            </div>
                            <span>Expression indexes for transformed data access</span>
                          </li>
                        </ul>
                        
                        <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mt-6">
                          <p className="text-yellow-800 text-sm">
                            <strong>Remember:</strong> Indexes speed up retrieval but slow down inserts, updates, and deletes. Use them strategically.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <button
                className="mt-6 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 w-full max-w-xs mx-auto"
                onClick={() => setCurrentPage('next')}
              >
                Next Page
              </button>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(DatabaseIndexVisualization));
      `;

      esbuild.transform(code, {
        loader: 'jsx',
        jsxFactory: 'React.createElement',
        jsxFragment: 'React.Fragment'
      }).then(result => {
        // Evaluate the transpiled code
        eval(result.code);
      }).catch(error => {
        console.error('esbuild transform error:', error);
      });
    });
  </script>
</body>
</html>